<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>YANNIC K√ñBI AKTIEN HANDEL AG ‚Äì KI Analyse</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.2.0/dist/tf.min.js"></script>

<style>
body{background:#121212;color:#d8f3ef;font-family:Arial,Helvetica,sans-serif;margin:0;padding:16px}
h1{text-align:center;margin:8px 0}
.subtitle{text-align:center;font-size:.85rem;color:#a8d8d0}
.controls{display:flex;justify-content:center;gap:10px;flex-wrap:wrap;margin:12px 0}
select,button{background:#1b1b1b;color:#d8f3ef;border:1px solid #00ccaa;padding:6px 12px;border-radius:6px;cursor:pointer}
button:hover{background:#00ccaa;color:#000}
.status{text-align:center;font-weight:bold;margin:6px}
canvas{max-width:1200px;margin:20px auto;display:block;background:#1a1a1a;border-radius:8px;padding:10px}
table{width:100%;max-width:1200px;margin:auto;border-collapse:collapse}
th,td{border:1px solid #00ccaa;padding:6px;text-align:center}
.buy{color:#00ff88;font-weight:bold}
.sell{color:#ff6666;font-weight:bold}
.hold{color:#ffaa55;font-weight:bold}
.stable{color:#00ff88}
.medium{color:#ffaa55}
.risky{color:#ff6666}
.ok{color:#00ff88}
.warn{color:#ffaa55}
.bad{color:#ff6666}
.tabs{display:flex;justify-content:center;gap:10px;margin-top:12px}
.tabbox{max-width:1200px;margin:12px auto;background:#1a1a1a;border:1px solid #00ccaa;padding:12px;border-radius:6px}
.hidden{display:none}
.footer{text-align:center;font-size:.8rem;color:#9fcfc8;margin-top:14px}
</style>
</head>

<body>

<h1>YANNIC K√ñBI AKTIEN HANDEL AG</h1>
<div class="subtitle">KI-gest√ºtzte Aktienanalyse ¬∑ Prognose ¬∑ Stabilit√§t</div>

<div class="controls">
<select id="stockSelect"></select>
<select id="timeSelect">
<option value="30">1 Monat</option>
<option value="60">2 Monate</option>
<option value="90" selected>3 Monate</option>
</select>
</div>

<div class="controls">
<button onclick="setMode('vorsichtig')">Vorsichtig</button>
<button onclick="setMode('ausgeglichen')">Ausgeglichen</button>
<button onclick="setMode('chancen')">Chancen</button>
</div>

<div class="controls">
<button onclick="analyze()">Analyse starten</button>
<button onclick="exportCSV()">CSV Export</button>
<button onclick="toggleFav()">‚≠ê Favorit</button>
</div>

<div class="status" id="status">System bereit</div>
<div class="status" id="datatime"></div>

<canvas id="chart"></canvas>

<table>
<thead>
<tr>
<th>Aktueller Kurs</th>
<th>Prognose</th>
<th>Signal</th>
<th>Confidence</th>
</tr>
</thead>
<tbody id="result"></tbody>
</table>

<div class="tabs">
<button onclick="showTab('analysis')">Analyse</button>
<button onclick="showTab('fundamental')">Fundamental</button>
</div>

<div id="analysis" class="tabbox">
<div id="explanation">‚Äì</div>
</div>

<div id="fundamental" class="tabbox hidden"></div>

<div class="footer">
¬© 2026 YANNIC K√ñBI AKTIEN HANDEL AG ¬∑ Keine Anlageberatung
</div>

<script>
"use strict";

/* ===== KONFIG ===== */
const API_KEY = atob("ZDVvaHFqaHIwMWFqc3Q2cXJqZ2Q1b2hxamhyMDFxamFzdDZxcmsw");
const WINDOW=20;
let ANALYSE_MODELL="ausgeglichen";
let LAST_TREND=null;
let chart;

/* ===== AKTIEN ===== */
const STOCKS=[
{t:"AAPL",n:"Apple Inc."},{t:"MSFT",n:"Microsoft Corporation"},
{t:"NVDA",n:"NVIDIA Corporation"},{t:"TSLA",n:"Tesla Inc."},
{t:"AMZN",n:"Amazon.com Inc."},{t:"GOOGL",n:"Alphabet Inc."},
{t:"META",n:"Meta Platforms Inc."},{t:"NFLX",n:"Netflix Inc."},
{t:"INTC",n:"Intel Corporation"},{t:"AMD",n:"Advanced Micro Devices Inc."},
{t:"BABA",n:"Alibaba Group Holding Ltd."},{t:"DIS",n:"The Walt Disney Company"},
{t:"KO",n:"The Coca-Cola Company"},{t:"PEP",n:"PepsiCo Inc."},
{t:"JNJ",n:"Johnson & Johnson"},{t:"PG",n:"Procter & Gamble Co."},
{t:"V",n:"Visa Inc."},{t:"MA",n:"Mastercard Inc."},
{t:"UBER",n:"Uber Technologies Inc."},{t:"SHOP",n:"Shopify Inc."},
{t:"SAP",n:"SAP SE"},{t:"ASML",n:"ASML Holding N.V."},
{t:"NESN.SW",n:"Nestl√© S.A."},{t:"ROG.SW",n:"Roche Holding AG"}
];

const select=document.getElementById("stockSelect");
STOCKS.forEach(s=>{
  const o=document.createElement("option");
  o.value=s.t;
  o.textContent=`${s.t} ‚Äì ${s.n}`;
  select.appendChild(o);
});

/* ===== UI ===== */
function setMode(m){ANALYSE_MODELL=m}
function showTab(id){
  document.querySelectorAll(".tabbox").forEach(b=>b.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

/* ===== TOOLS ===== */
function EMA(d,p){const k=2/(p+1);let e=d[0];for(let i=1;i<d.length;i++)e=d[i]*k+e*(1-k);return e;}
function RSI(p){let g=0,l=0;for(let i=p.length-14;i<p.length-1;i++){const d=p[i+1]-p[i];d>0?g+=d:l-=d;}return 100-(100/(1+(g/(l||1))));}
function volatility(p){const m=p.reduce((a,b)=>a+b)/p.length;const v=Math.sqrt(p.reduce((s,x)=>s+(x-m)**2,0)/p.length);return (v/m)*100;}
function stability(v){if(v<2)return["Stabil","stable"];if(v<5)return["Mittel","medium"];return["Instabil","risky"];}
function thresholds(){if(ANALYSE_MODELL==="vorsichtig")return{buy:.08,sell:-.04};if(ANALYSE_MODELL==="chancen")return{buy:.03,sell:-.08};return{buy:.05,sell:-.05};}

/* ===== MARKTDATEN MIT ECHTEM FALLBACK ===== */
async function fetchPrices(symbol,days){
  const now=Math.floor(Date.now()/1000);
  const from=now-days*86400;

  try{
    const r=await fetch(`https://finnhub.io/api/v1/stock/candle?symbol=${symbol}&resolution=D&from=${from}&to=${now}&token=${API_KEY}`);
    const d=await r.json();
    if(d.s==="ok"&&d.c&&d.c.length>=20){
      localStorage.setItem("LAST_REAL_"+symbol,JSON.stringify(d.c));
      localStorage.setItem("LAST_TIME_"+symbol,new Date().toLocaleString());
      datatime.textContent="Datenstand: "+new Date().toLocaleString();
      return d.c;
    }
  }catch(e){}

  const cached=localStorage.getItem("LAST_REAL_"+symbol);
  const time=localStorage.getItem("LAST_TIME_"+symbol);
  if(cached){
    datatime.textContent="Datenstand (Fallback): "+time;
    return JSON.parse(cached);
  }
  throw "Keine Marktdaten verf√ºgbar";
}

/* ===== KI ===== */
async function predict(prices){
  status.textContent="üß† KI wird trainiert‚Ä¶";
  const min=Math.min(...prices),max=Math.max(...prices),r=max-min||1;
  const n=prices.map(p=>(p-min)/r),X=[],Y=[];
  for(let i=0;i<n.length-WINDOW;i++){X.push(n.slice(i,i+WINDOW).map(v=>[v]));Y.push(n[i+WINDOW]);}
  const xs=tf.tensor3d(X),ys=tf.tensor2d(Y,[Y.length,1]);

  let model;
  try{model=await tf.loadLayersModel("localstorage://model_"+select.value);}
  catch{
    model=tf.sequential();
    model.add(tf.layers.lstm({units:64,dropout:0.2,recurrentDropout:0.2,inputShape:[WINDOW,1]}));
    model.add(tf.layers.dense({units:1}));
    model.compile({optimizer:"adam",loss:"mse"});
  }

  await model.fit(xs,ys,{epochs:40,batchSize:16,shuffle:true,verbose:0});
  await model.save("localstorage://model_"+select.value);

  let w=n.slice(-WINDOW),f=[];
  for(let i=0;i<10;i++){
    const p=model.predict(tf.tensor3d([w.map(v=>[v])])).dataSync()[0];
    w.shift();w.push(p);f.push(p*r+min);
  }
  return f;
}

/* ===== BACKTEST ===== */
function backtestAccuracy(prices,forecast){
  const real=prices.slice(-forecast.length);
  let err=0;
  for(let i=0;i<forecast.length;i++){
    err+=Math.abs((forecast[i]-real[i])/real[i]);
  }
  return 100-(err/forecast.length)*100;
}

/* ===== ANALYSE ===== */
async function analyze(){
  try{
    status.textContent="Analyse l√§uft‚Ä¶";
    const prices=await fetchPrices(select.value,+timeSelect.value);
    const forecast=await predict(prices);

    const last=prices.at(-1),pred=forecast.at(-1);
    const ema9=EMA(prices,9),ema21=EMA(prices,21);
    const trend=ema9>ema21?"Aufw√§rts":"Abw√§rts";
    if(LAST_TREND&&LAST_TREND!==trend)alert("‚ö†Ô∏è Trendwechsel erkannt");
    LAST_TREND=trend;

    const rsi=RSI(prices),vol=volatility(prices);
    const [stabText,stabClass]=stability(vol);
    const diff=(pred-last)/last;
    const t=thresholds();

    let signal="HALTEN",cls="hold";
    if(diff>t.buy&&trend==="Aufw√§rts"&&rsi<70){signal="KAUFEN";cls="buy";}
    if(diff<t.sell&&trend==="Abw√§rts"&&rsi>30){signal="VERKAUFEN";cls="sell";}

    const confidence=Math.min(100,Math.abs(diff)*100*2+(trend==="Aufw√§rts"?10:0)+(5-vol));
    const accuracy=backtestAccuracy(prices,forecast);

    result.innerHTML=`<tr>
      <td>${last.toFixed(2)}</td>
      <td>${pred.toFixed(2)}</td>
      <td class="${cls}">${signal}</td>
      <td>${confidence.toFixed(0)}%</td>
    </tr>`;

    explanation.innerHTML=
      `Trend: ${trend}<br>
       RSI: ${rsi.toFixed(1)}<br>
       Modus: ${ANALYSE_MODELL}<br>
       KI-Genauigkeit (Backtest): ${accuracy.toFixed(1)}%`;

    fundamental.innerHTML=
      `<b>Firmen-Stabilit√§t:</b>
       <span class="${stabClass}">${stabText}</span><br>
       <b>Volatilit√§t:</b> ${vol.toFixed(2)} %`;

    if(signal==="KAUFEN"&&rsi>70){
      status.innerHTML+=" ‚ö†Ô∏è √úberkauft ‚Äì m√∂gliches Fehlsignal";
    }

    status.className="status "+(confidence>70?"ok":confidence>40?"warn":"bad");

    if(chart)chart.destroy();
    chart=new Chart(chartEl,{
      type:"line",
      data:{
        labels:[...prices.map((_,i)=>"T"+i),...forecast.map((_,i)=>"F"+i)],
        datasets:[
          {label:"Kurs",data:[...prices,...Array(forecast.length).fill(null)],borderColor:"#00ccaa"},
          {label:"KI-Prognose",data:[...Array(prices.length).fill(null),...forecast],borderColor:"#ffaa55"}
        ]
      }
    });

    status.textContent+=" ‚úì Analyse abgeschlossen";
  }catch(e){
    status.textContent="Fehler: "+e;
  }
}

function exportCSV(){
  const r=document.querySelector("#result tr");if(!r)return;
  const c=[...r.children].map(td=>td.innerText);
  const csv="Aktie,Preis,Prognose,Signal,Confidence\n"+select.value+","+c.join(",");
  const b=new Blob([csv],{type:"text/csv"});
  const a=document.createElement("a");a.href=URL.createObjectURL(b);a.download=select.value+"_analyse.csv";a.click();
}
function toggleFav(){
  let f=JSON.parse(localStorage.getItem("FAVS")||"[]");
  f.includes(select.value)?f=f.filter(x=>x!==select.value):f.push(select.value);
  localStorage.setItem("FAVS",JSON.stringify(f));
  alert("Favoriten aktualisiert");
}

setInterval(()=>analyze(),5*60*1000);
</script>
</body>
</html>

