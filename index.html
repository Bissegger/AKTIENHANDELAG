<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Next-Gen Aktien KI</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial"></script>

<style>
body{background:#0e0e0e;color:#e8fef9;font-family:Arial;margin:0;padding:14px}
h1{text-align:center;font-size:1.4rem}
.subtitle{text-align:center;font-size:.8rem;color:#9fd3cc}

select,button{
  width:100%;padding:10px;margin:6px 0;
  border-radius:8px;background:#1b1b1b;
  color:#e8fef9;border:1px solid #00ccaa
}

.status{text-align:center;font-weight:bold;margin:6px 0}

canvas{height:280px!important;background:#161616;border-radius:10px}

.box{
  border:1px solid #00ccaa;border-radius:8px;
  padding:10px;margin-top:10px;background:#161616;font-size:.85rem
}

.good{color:#00ff88}
.bad{color:#ff6666}
.neutral{color:#ffaa55}
</style>
</head>

<body>

<h1>üß† NEXT-GEN TRADING KI</h1>
<div class="subtitle">Timing ¬∑ Kontext ¬∑ Risiko</div>

<select id="stock"></select>
<button onclick="analyze()">Analyse starten</button>

<div class="status" id="market"></div>
<div class="status" id="countdown"></div>
<div class="status" id="status">Bereit</div>

<canvas id="chart"></canvas>

<div class="box">
<b>üìå Erkannte Haupt-Signale</b>
<div id="reasons">‚Äì</div>
</div>

<div class="box">
<b>‚è± Timing-KI</b>
<div id="timing">‚Äì</div>
</div>

<div class="box">
<b>‚ö†Ô∏è Risiko-KI (Wann kippt das Signal?)</b>
<div id="risk">‚Äì</div>
</div>

<div class="box">
<b>üéØ Finale KI-Entscheidung</b>
<div id="decision">‚Äì</div>
</div>

<script>
const API="d5ohqjhr01qjast6qrjgd5ohqjhr01qjast6qrk0";

const STOCKS=[
["AAPL","Apple"],["MSFT","Microsoft"],["NVDA","NVIDIA"],
["AMZN","Amazon"],["TSLA","Tesla"],
["NESN.SW","Nestl√©"],["ROG.SW","Roche"],["NOVN.SW","Novartis"]
];

const stock=document.getElementById("stock");
STOCKS.forEach(s=>{
  const o=document.createElement("option");
  o.value=s[0]; o.textContent=s[1];
  stock.appendChild(o);
});

function updateMarket(){
  const now=new Date();
  const d=now.getDay();
  const isCH=stock.value.endsWith(".SW");

  const openH=isCH?9:15, openM=isCH?0:30;
  const closeH=isCH?17:22, closeM=isCH?30:0;

  const open=new Date(now); open.setHours(openH,openM,0,0);
  const close=new Date(now); close.setHours(closeH,closeM,0,0);

  const openNow=(d>=1&&d<=5&&now>=open&&now<close);

  market.textContent=openNow?"üü¢ B√∂rse offen":"üî¥ B√∂rse geschlossen";

  let target=openNow?close:open;
  if(!openNow && now>close) target.setDate(target.getDate()+1);

  const diff=target-now;
  const h=Math.max(0,Math.floor(diff/36e5));
  const m=Math.max(0,Math.floor(diff%36e5/6e4));
  const s=Math.max(0,Math.floor(diff%6e4/1e3));

  countdown.textContent=
    (openNow?"Schlie√üt in ":"√ñffnet in ")+
    `${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
}
setInterval(updateMarket,1000);
updateMarket();

async function fetchCandles(sym){
  const now=Math.floor(Date.now()/1000);
  const from=now-86400*90;
  const r=await fetch(
    `https://finnhub.io/api/v1/stock/candle?symbol=${sym}&resolution=D&from=${from}&to=${now}&token=${API}`
  );
  const d=await r.json();
  return d.s==="ok"?d:null;
}

function analyze(){
  status.textContent="Analyse l√§uft‚Ä¶";

  fetchCandles(stock.value).then(d=>{
    if(!d){status.textContent="Keine Daten";return;}

    const c=d.c, o=d.o, h=d.h, l=d.l;
    const n=c.length-1;
    const last=c[n], prev=c[n-1];

    let reasons=[], score=0;

    // Candlestick
    if(Math.abs(c[n]-o[n])<(h[n]-l[n])*0.1){
      reasons.push("Doji ‚Üí Unsicherheit");
      score-=1;
    }
    if(c[n]>o[n] && c[n-1]<o[n-1]){
      reasons.push("Bullish Engulfing");
      score+=4;
    }

    // Trend
    if(last>c[n-5]){reasons.push("Aufw√§rtstrend");score+=3;}
    if(last<c[n-5]){reasons.push("Abw√§rtstrend");score-=3;}

    // TIMING-KI
    let timingText="Jetzt guter Zeitpunkt";
    if(score>=5) timingText="‚ö†Ô∏è Starkes Signal ‚Äì evtl. R√ºcksetzer abwarten";
    if(score<=-4) timingText="‚ùå Zu sp√§t / fallender Markt";

    // RISIKO-KI
    const invalid=score>0?last*0.97:last*1.03;
    const riskText=
      `Signal g√ºltig solange Kurs ${score>0?"√ºber":"unter"} ${invalid.toFixed(2)} bleibt`;

    // FINAL
    let signal="HALTEN";
    if(score>=4) signal="KAUFEN";
    if(score<=-4) signal="VERKAUFEN";

    reasonsDiv.innerHTML=reasons.map(r=>"‚Ä¢ "+r).join("<br>");
    timing.innerHTML=timingText;
    risk.innerHTML=riskText;
    decision.innerHTML=
      `Signal: <b>${signal}</b><br>`+
      `KI-Score: ${(score+10)*5}/100`;

    if(window.chart) chart.destroy();
    chart=new Chart(chartEl,{
      type:"candlestick",
      data:{datasets:[{data:c.map((_,i)=>({
        x:i,o:o[i],h:h[i],l:l[i],c:c[i]
      }))}]}
    });

    status.textContent="Analyse abgeschlossen";
  });
}
</script>

</body>
</html>
