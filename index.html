<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>AI Trading Pro C2</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{background:#0f1115;color:#e7fdf9;font-family:system-ui;margin:0;padding:15px}
h1{text-align:center;font-size:1.5rem}
select,button{
  width:100%;padding:14px;margin-top:10px;
  border-radius:12px;border:1px solid #00ffaa;
  background:#141822;color:white;font-size:1rem
}
button:disabled{opacity:.6}
.box{background:#141822;border-radius:12px;padding:12px;margin-top:12px}
.status{text-align:center;margin-top:10px;font-weight:bold}
canvas{margin-top:15px;background:#111;border-radius:12px}
.green{color:#00ff99}
.red{color:#ff4d4d}
.orange{color:#ffaa00}
</style>
</head>

<body>

<h1>AI Trading Pro C2</h1>

<select id="stock">
<option value="AAPL">AAPL (US)</option>
<option value="MSFT">MSFT (US)</option>
<option value="NVDA">NVDA (US)</option>
<option value="TSLA">TSLA (US)</option>
<option value="AMZN">AMZN (US)</option>
<option value="META">META (US)</option>
<option value="GOOGL">GOOGL (US)</option>
<option value="JPM">JPM (US)</option>
<option value="V">V (US)</option>

<option value="SAP.DE">SAP (EU)</option>
<option value="ASML.AS">ASML (EU)</option>
<option value="NESN.SW">NestlÃ© (EU)</option>
<option value="ROG.SW">Roche (EU)</option>
<option value="ABB.SW">ABB (EU)</option>
</select>

<select id="horizon">
<option value="1">1 Tag</option>
<option value="22">1 Monat</option>
<option value="66">3 Monate</option>
</select>

<button id="analyze">Analyse starten</button>

<div class="status" id="marketStatus">Marktstatus...</div>

<div class="box" id="results">
Aktueller Preis: â€“<br>
Prognose: â€“<br>
Prognose-Datum: â€“<br>
Confidence: â€“<br>
Crash-Risiko: â€“<br>
Marktphase: â€“<br>
RSI: â€“<br>
Risk Score: â€“
</div>

<canvas id="chart" height="260"></canvas>

<script>
const btn=document.getElementById("analyze");
const stockSel=document.getElementById("stock");
const horizon=document.getElementById("horizon");
const results=document.getElementById("results");
const statusEl=document.getElementById("marketStatus");

let chart;

/* ðŸ•’ Marktstatus */
function updateMarketStatus(){
  const now=new Date();
  const day=now.getDay();
  const hour=now.getHours()+now.getMinutes()/60;

  const symbol=stockSel.value;
  const isEU=symbol.includes(".DE")||symbol.includes(".AS")||symbol.includes(".SW");

  if(day===0||day===6){
    statusEl.innerHTML="<span class='red'>BÃ¶rse geschlossen (Wochenende)</span>";
    return;
  }

  if(isEU){
    if(hour>=9&&hour<17.5)
      statusEl.innerHTML="<span class='green'>EU Markt offen</span>";
    else
      statusEl.innerHTML="<span class='red'>EU Markt geschlossen</span>";
  }else{
    if(hour>=15.5&&hour<22)
      statusEl.innerHTML="<span class='green'>US Markt offen</span>";
    else
      statusEl.innerHTML="<span class='red'>US Markt geschlossen</span>";
  }
}

stockSel.addEventListener("change",updateMarketStatus);
setInterval(updateMarketStatus,60000);
updateMarketStatus();

/* ðŸ“… Prognose Datum */
function futureDate(days){
  const d=new Date();
  let count=0;
  while(count<days){
    d.setDate(d.getDate()+1);
    if(d.getDay()!=0&&d.getDay()!=6) count++;
  }
  return d.toLocaleDateString("de-CH");
}

btn.onclick=async()=>{
  btn.disabled=true;
  results.innerHTML="Lade Daten...";

  try{
    const symbol=stockSel.value;
    const days=parseInt(horizon.value);

    const stockRes=await fetch(`/api/stock?symbol=${symbol}`);
    const stockData=await stockRes.json();

    if(stockData.error) throw "No Data";

    const newsRes=await fetch(`/api/news?symbol=${symbol}`);
    const newsData=await newsRes.json();

    const predRes=await fetch("/api/predict",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({
        prices:stockData.prices,
        days,
        sentiment:newsData.sentiment
      })
    });

    const pred=await predRes.json();

    if(chart) chart.destroy();
    chart=new Chart(document.getElementById("chart"),{
      type:"line",
      data:{
        labels:stockData.prices.map((_,i)=>i),
        datasets:[{
          data:stockData.prices,
          borderColor:"#00ffaa",
          tension:.3
        }]
      },
      options:{plugins:{legend:{display:false}}}
    });

    const crashColor =
      pred.crashRisk>70?"red":
      pred.crashRisk>40?"orange":"green";

    results.innerHTML=`
      Aktueller Preis: ${stockData.price.toFixed(2)}<br>
      Prognose: ${pred.predicted.toFixed(2)}<br>
      Prognose-Datum: ${futureDate(days)}<br>
      Confidence: ${pred.confidence}%<br>
      Crash-Risiko: <span class="${crashColor}">${pred.crashRisk}%</span><br>
      Marktphase: ${pred.regime}<br>
      RSI: ${pred.rsi}<br>
      Risk Score: ${pred.risk}
    `;

  }catch(e){
    results.innerHTML="<span class='red'>Fehler beim Laden der Daten</span>";
  }

  btn.disabled=false;
};
</script>

</body>
</html>


