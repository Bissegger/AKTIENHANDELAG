<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>KI Aktien Analyse 2026</title>

<style>
body{
  background:#0f1115;
  color:#e7fdf9;
  font-family:system-ui;
  margin:0;
  padding:12px
}
h1{text-align:center;font-size:1.4rem;margin:6px 0}
small{text-align:center;display:block;color:#9cc}

select,button{
  width:100%;
  padding:14px;
  margin-top:10px;
  font-size:1rem;
  border-radius:12px;
  border:1px solid #00ccaa;
  background:#141822;
  color:#e7fdf9
}
button:disabled{opacity:.6}

.status{text-align:center;margin-top:8px;font-weight:bold}
.hint{text-align:center;font-size:.85rem;color:#9cc}

.progress{
  height:7px;
  background:#1e2433;
  border-radius:4px;
  overflow:hidden;
  margin-top:6px
}
.progress div{
  height:100%;
  width:0%;
  background:#00ccaa;
  transition:.3s
}

.box{
  background:#141822;
  border:1px solid #00ccaa;
  border-radius:12px;
  padding:10px;
  margin-top:10px
}

.value{
  text-align:center;
  font-size:1.2rem;
  margin-top:8px
}

canvas{
  margin-top:12px;
  background:#111;
  border-radius:12px
}
</style>
</head>

<body>

<h1>KI Aktien Analyse 2026</h1>
<small>Echte Marktdaten ‚Ä¢ Selbstlernende KI ‚Ä¢ Browser-AI</small>

<select id="stock"></select>

<button id="analyzeBtn">üîç Analyse starten</button>

<div class="status" id="marketStatus">Marktstatus‚Ä¶</div>
<div class="hint" id="countdown"></div>

<div class="value" id="currentValue">Aktueller Wert: ‚Äì</div>
<div class="value" id="futureValue">Prognose: ‚Äì</div>

<div class="status" id="status">Bereit</div>

<div class="progress"><div id="bar"></div></div>

<canvas id="chart" height="260"></canvas>

<div class="box">
  <b>KI-Analyse</b>
  <div id="info">‚Äì</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
/* ================= AKTIEN ================= */
const STOCKS=[
 ["AAPL","Apple"],["MSFT","Microsoft"],["NVDA","NVIDIA"],
 ["TSLA","Tesla"],["AMZN","Amazon"],["GOOGL","Alphabet"],
 ["META","Meta"],["SAP","SAP"],["ASML","ASML"],
 ["NESN","Nestl√©"],["ROG","Roche"],["ABB","ABB"],
 ["JPM","JPMorgan"],["V","Visa"],["MA","Mastercard"],
 ["KO","Coca-Cola"],["AMD","AMD"],["INTC","Intel"]
];

const stockSel=document.getElementById("stock");
STOCKS.forEach(s=>{
  const o=document.createElement("option");
  o.value=s[0];
  o.textContent=s[0]+" ‚Äì "+s[1];
  stockSel.appendChild(o);
});

/* ================= MARKTZEITEN ================= */
function marketInfo(sym){
  const EU=["SAP","ASML","NESN","ROG","ABB"];
  const now=new Date(),d=now.getDay();
  const h=now.getHours()+now.getMinutes()/60;
  const isEU=EU.includes(sym);

  if(d===0||d===6){
    return {open:false,text:"Wochenende ‚Äì √∂ffnet Montag"};
  }

  if(isEU){
    if(h>=9&&h<17.5) return {open:true,text:`EU offen ‚Äì schlie√üt in ${Math.round((17.5-h)*60)} Min`};
    if(h<9) return {open:false,text:`EU √∂ffnet in ${Math.round((9-h)*60)} Min`};
    return {open:false,text:"EU √∂ffnet morgen 09:00"};
  }else{
    if(h>=15.5&&h<22) return {open:true,text:`US offen ‚Äì schlie√üt in ${Math.round((22-h)*60)} Min`};
    if(h<15.5) return {open:false,text:`US √∂ffnet in ${Math.round((15.5-h)*60)} Min`};
    return {open:false,text:"US √∂ffnet morgen 15:30"};
  }
}

function updateMarket(){
  const m=marketInfo(stockSel.value);
  marketStatus.textContent=m.open?"üü¢ B√∂rse offen":"üî¥ B√∂rse geschlossen";
  countdown.textContent=m.text;
}
setInterval(updateMarket,1000);
stockSel.addEventListener("change",updateMarket);
updateMarket();

/* ================= CHART ================= */
let chart;
function drawChart(prices){
  if(chart) chart.destroy();
  chart=new Chart(chartEl,{
    type:"line",
    data:{
      labels:prices.map((_,i)=>i),
      datasets:[{data:prices,borderColor:"#00ccaa",tension:.3}]
    },
    options:{plugins:{legend:{display:false}}}
  });
}
const chartEl=document.getElementById("chart");

/* ================= COMMON ================= */
const bar=document.getElementById("bar");
const statusEl=document.getElementById("status");
const info=document.getElementById("info");
const btn=document.getElementById("analyzeBtn");
const curVal=document.getElementById("currentValue");
const futVal=document.getElementById("futureValue");
function progress(p){bar.style.width=p+"%";}

/* ================= API ================= */
const API_KEY="fb30e9c5783845ab83a6e9c57e4d75cd"; // Twelve Data
async function loadData(sym){
  const url=`https://api.twelvedata.com/time_series?symbol=${sym}&interval=1day&outputsize=40&apikey=${API_KEY}`;
  const r=await fetch(url);
  const j=await r.json();
  if(!j.values) throw "NO_DATA";
  return j.values.map(v=>+v.close).reverse();
}

/* ================= LERNENDE KI ================= */
function loadMemory(sym){
  return JSON.parse(localStorage.getItem("ki_"+sym)||"[]");
}
function saveMemory(sym,entry){
  const m=loadMemory(sym);
  m.push(entry);
  if(m.length>200) m.shift();
  localStorage.setItem("ki_"+sym,JSON.stringify(m));
}
function accuracy(sym){
  const m=loadMemory(sym).filter(x=>x.real);
  if(m.length<5) return "‚Äì";
  const hit=m.filter(x=>Math.sign(x.real-x.start)===Math.sign(x.pred-x.start)).length;
  return Math.round(hit/m.length*100)+" %";
}

/* ================= PROGNOSE ================= */
function runKI(prices){
  const n=prices.length-1;
  const last=prices[n];
  const prev=prices[n-1];
  const trend=(last-prices[n-5])/prices[n-5];
  const momentum=last-prev;
  const vol=Math.abs(last-prices[n-3])/last;

  let delta=(trend*0.6)+(momentum/last*0.3)-(vol*0.2);
  delta=Math.max(-0.05,Math.min(0.05,delta));

  return last*(1+delta);
}

/* ================= ANALYSE ================= */
btn.addEventListener("click",async()=>{
  btn.disabled=true;
  statusEl.textContent="Analyse l√§uft‚Ä¶";
  progress(15);

  try{
    const prices=await loadData(stockSel.value);
    drawChart(prices);

    const current=prices.at(-1);
    const future=runKI(prices);

    curVal.textContent="Aktueller Wert: "+current.toFixed(2);
    futVal.textContent="Prognose n√§chster Zustand: "+future.toFixed(2);

    saveMemory(stockSel.value,{start:current,pred:future});

    info.innerHTML=`
      <b>Marktqualit√§t:</b> ${Math.abs(future-current)/current<0.01?"ruhig":"aktiv"}<br>
      <b>KI-Trefferquote:</b> ${accuracy(stockSel.value)}<br>
      <b>Lernstatus:</b> ${loadMemory(stockSel.value).length} gespeicherte Prognosen
    `;

    progress(100);
    statusEl.textContent="‚úÖ Analyse abgeschlossen";
  }catch{
    statusEl.textContent="‚ö†Ô∏è Keine Marktdaten";
    progress(0);
  }
  btn.disabled=false;
});
</script>

</body>
</html>

