<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>YANNIC KÃ–BI AKTIEN HANDEL AG â€“ KI Analyse</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{background:#121212;color:#d8f3ef;font-family:Arial;margin:0;padding:16px}
h1{text-align:center}
.subtitle{text-align:center;color:#9fd3cc;font-size:.85rem;margin-bottom:10px}
.controls{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin:10px 0}
select,button{background:#1b1b1b;color:#d8f3ef;border:1px solid #00ccaa;padding:6px 12px;border-radius:6px;cursor:pointer}
button:hover{background:#00ccaa;color:#000}
.status{text-align:center;font-weight:bold;margin:6px 0}
canvas{max-width:1200px;margin:20px auto;display:block;background:#1a1a1a;border-radius:8px;padding:10px}
table{width:100%;border-collapse:collapse;margin-top:12px}
th,td{border:1px solid #00ccaa;padding:6px;text-align:center}
.buy{color:#00ff88;font-weight:bold}
.sell{color:#ff6666;font-weight:bold}
.hold{color:#ffaa55;font-weight:bold}
.footer{text-align:center;font-size:.8rem;color:#9fcfc8;margin-top:14px}
</style>
</head>

<body>

<h1>YANNIC KÃ–BI AKTIEN HANDEL AG</h1>
<div class="subtitle">Echte Marktdaten Â· Candlestick-KI Â· Sofort-Analyse</div>

<div class="controls">
  <select id="stock"></select>
  <select id="days">
    <option value="30">1 Monat</option>
    <option value="60">2 Monate</option>
    <option value="90" selected>3 Monate</option>
  </select>
</div>

<div class="controls">
  <button onclick="toggleKI()" id="kiBtn">ðŸ§  KI: EIN</button>
  <button onclick="analyze()">Analyse starten</button>
</div>

<div class="status" id="market"></div>
<div class="status" id="countdown"></div>
<div class="status" id="status">System bereit</div>

<canvas id="chart"></canvas>

<table>
<thead>
<tr>
  <th>Aktueller Kurs (CHF)</th>
  <th>Prognose (CHF)</th>
  <th>Signal</th>
  <th>StabilitÃ¤t</th>
  <th>Pattern</th>
</tr>
</thead>
<tbody id="result"></tbody>
</table>

<div class="footer">Â© 2026 â€“ Keine Anlageberatung</div>

<script>
"use strict";

/* ================= CONFIG ================= */
const API_KEY="d5ohqjhr01qjast6qrjgd5ohqjhr01qjast6qrk0";
let KI=true;
let chart;

/* ================= AKTIEN (ALLE OK) ================= */
const STOCKS=[
["AAPL","Apple Inc."],["MSFT","Microsoft Corp."],["NVDA","NVIDIA Corp."],
["AMZN","Amazon.com Inc."],["TSLA","Tesla Inc."],["GOOGL","Alphabet Inc."],
["META","Meta Platforms"],["NFLX","Netflix Inc."],["INTC","Intel Corp."],
["AMD","Advanced Micro Devices"],["SAP","SAP SE"],["ASML","ASML Holding"],
["NESN.SW","NestlÃ© SA"],["ROG.SW","Roche Holding AG"],
["NOVN.SW","Novartis AG"],["UBSG.SW","UBS Group AG"]
];

const stockSel=document.getElementById("stock");
STOCKS.forEach(s=>{
  const o=document.createElement("option");
  o.value=s[0];
  o.textContent=`${s[0]} â€“ ${s[1]}`;
  stockSel.appendChild(o);
});

/* ================= KI ================= */
function toggleKI(){
  KI=!KI;
  document.getElementById("kiBtn").textContent="ðŸ§  KI: "+(KI?"EIN":"AUS");
}

/* ================= MARKET STATUS ================= */
function updateMarket(){
  const now=new Date();
  const d=now.getDay();
  const swiss=stockSel.value.endsWith(".SW");
  const openH=swiss?9:15.5;
  const closeH=swiss?17.5:22;

  let open=new Date(now);
  open.setHours(Math.floor(openH),(openH%1)*60,0,0);
  let close=new Date(now);
  close.setHours(Math.floor(closeH),(closeH%1)*60,0,0);

  let txt="",cd="";
  if(d===0||d===6){
    txt="ðŸ”´ BÃ¶rse geschlossen (Wochenende)";
    cd="Ã–ffnet Montag";
  }else if(now>=open&&now<close){
    txt="ðŸŸ¢ BÃ¶rse offen";
    cd="SchlieÃŸt "+close.toLocaleTimeString("de-CH",{hour:"2-digit",minute:"2-digit"});
  }else{
    txt="ðŸŸ¡ BÃ¶rse geschlossen";
    cd="Ã–ffnet "+open.toLocaleTimeString("de-CH",{hour:"2-digit",minute:"2-digit"});
  }
  market.textContent=txt;
  countdown.textContent=cd;
}

/* ================= DATA ================= */
async function fetchOHLC(symbol,days){
  const now=Math.floor(Date.now()/1000);
  const from=now-300*86400;
  try{
    const r=await fetch(
      `https://finnhub.io/api/v1/stock/candle?symbol=${symbol}&resolution=D&from=${from}&to=${now}&token=${API_KEY}`
    );
    const d=await r.json();
    if(d.s==="ok"&&d.c.length){
      localStorage.setItem("CACHE_"+symbol,JSON.stringify(d));
      return {
        o:d.o.slice(-days),
        h:d.h.slice(-days),
        l:d.l.slice(-days),
        c:d.c.slice(-days)
      };
    }
  }catch{}
  const cache=localStorage.getItem("CACHE_"+symbol);
  if(!cache) return null;
  const d=JSON.parse(cache);
  return {
    o:d.o.slice(-days),
    h:d.h.slice(-days),
    l:d.l.slice(-days),
    c:d.c.slice(-days)
  };
}

/* ================= PATTERN KI ================= */
function analyzePatterns(o,h,l,c){
  let score=0,patterns=[];
  const i=c.length-1;
  if(i<1) return {score,patterns};

  const body=Math.abs(c[i]-o[i]);
  const range=h[i]-l[i];

  if(body<range*0.1){patterns.push("Doji");score+=1;}
  if(c[i]>o[i]&&c[i-1]<o[i-1]&&c[i]>o[i-1]){
    patterns.push("Bullish Engulfing");score+=3;
  }
  if(o[i]>c[i]&&c[i-1]>o[i-1]&&o[i]>c[i-1]){
    patterns.push("Bearish Engulfing");score-=3;
  }
  if((c[i]-l[i])>2*body){patterns.push("Hammer");score+=2;}

  return {score,patterns};
}

/* ================= CHART ================= */
function draw(prices,forecast){
  if(chart) chart.destroy();
  chart=new Chart(document.getElementById("chart"),{
    type:"line",
    data:{
      labels:[...prices.map((_,i)=>"T"+(i+1)),...forecast.map((_,i)=>"F"+(i+1))],
      datasets:[
        {label:"Kurs",data:[...prices,...Array(forecast.length).fill(null)],borderColor:"#00ccaa"},
        {label:"Prognose",data:[...Array(prices.length).fill(null),...forecast],borderColor:"#ffaa55"}
      ]
    }
  });
}

/* ================= ANALYSE ================= */
async function analyze(){
  status.textContent="Analyse lÃ¤uftâ€¦";
  updateMarket();

  const days=parseInt(document.getElementById("days").value);
  const d=await fetchOHLC(stockSel.value,days);
  if(!d||d.c.length===0){
    status.textContent="Keine Marktdaten verfÃ¼gbar";
    return;
  }

  const prices=d.c.map(p=>p*0.93);
  const last=prices.at(-1);

  const {score,patterns}=analyzePatterns(d.o,d.h,d.l,d.c);

  let factor=0.002;
  if(score>2) factor=0.008;
  if(score<0) factor=-0.006;
  if(!KI) factor=0;

  const forecast=Array.from({length:7},(_,i)=>last*(1+factor*(i+1)));

  draw(prices,forecast);

  const diff=(forecast.at(-1)-last)/last;
  const signal=diff>0.05?"KAUFEN":diff<-0.05?"VERKAUFEN":"HALTEN";
  const cls=signal==="KAUFEN"?"buy":signal==="VERKAUFEN"?"sell":"hold";
  const stability=Math.max(20,100-Math.abs(diff)*600);

  result.innerHTML=`
  <tr>
    <td>${last.toFixed(2)}</td>
    <td>${forecast.at(-1).toFixed(2)}</td>
    <td class="${cls}">${signal}</td>
    <td>${Math.round(stability)}/100</td>
    <td>${patterns.join(", ")||"â€“"}</td>
  </tr>`;

  status.textContent="Analyse abgeschlossen";
}

setInterval(updateMarket,1000);
</script>

</body>
</html>
