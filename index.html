<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>YANNIC KÖBI AKTIEN HANDEL AG – KI-Analyse</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.2.0/dist/tf.min.js"></script>

<style>
body{background:#121212;color:#d8f3ef;font-family:Arial,Helvetica,sans-serif;margin:0;padding:16px}
h1{text-align:center;margin:8px 0}
.subtitle{text-align:center;font-size:.85rem;color:#a8d8d0}
.controls{display:flex;justify-content:center;gap:10px;flex-wrap:wrap;margin:12px 0}
select,button{background:#1b1b1b;color:#d8f3ef;border:1px solid #00ccaa;padding:6px 12px;border-radius:6px}
button:hover{background:#00ccaa;color:#000}
.status{text-align:center;font-weight:bold;margin:10px}
canvas{max-width:1200px;margin:20px auto;display:block;background:#1a1a1a;border-radius:8px;padding:10px}
table{width:100%;max-width:1200px;margin:auto;border-collapse:collapse}
th,td{border:1px solid #00ccaa;padding:6px;text-align:center}
.buy{color:#00ff88;font-weight:bold}
.sell{color:#ff6666;font-weight:bold}
.hold{color:#ffaa55;font-weight:bold}
.stable{color:#00ff88}
.medium{color:#ffaa55}
.risky{color:#ff6666}
.tabs{display:flex;justify-content:center;gap:10px;margin-top:12px}
.tabbox{max-width:1200px;margin:12px auto;background:#1a1a1a;border:1px solid #00ccaa;padding:12px;border-radius:6px}
.hidden{display:none}
.footer{text-align:center;font-size:.8rem;color:#9fcfc8;margin-top:14px}
</style>
</head>

<body>

<h1>YANNIC KÖBI AKTIEN HANDEL AG</h1>
<div class="subtitle">KI-gestützte Aktienanalyse · Prognose · Stabilität</div>

<div class="controls">
<select id="stockSelect"></select>
<select id="timeSelect">
<option value="30">1 Monat</option>
<option value="60">2 Monate</option>
<option value="90" selected>3 Monate</option>
</select>
</div>

<div class="controls">
<button onclick="setMode('vorsichtig')">Vorsichtig</button>
<button onclick="setMode('ausgeglichen')">Ausgeglichen</button>
<button onclick="setMode('chancen')">Chancen</button>
</div>

<div class="controls">
<button onclick="analyze()">Analyse starten</button>
<button onclick="openBuyPage()">Externe Kursansicht</button>
</div>

<div class="status" id="status">System bereit</div>

<canvas id="chart"></canvas>

<table>
<thead>
<tr>
<th>Aktueller Kurs</th>
<th>Prognose</th>
<th>Signal</th>
<th>Confidence</th>
</tr>
</thead>
<tbody id="result"></tbody>
</table>

<div class="tabs">
<button onclick="showTab('analysis')">Analyse</button>
<button onclick="showTab('fundamental')">Fundamental</button>
</div>

<div id="analysis" class="tabbox">
<div id="explanation">–</div>
</div>

<div id="fundamental" class="tabbox hidden"></div>

<div class="footer">
© 2026 YANNIC KÖBI AKTIEN HANDEL AG · Keine Anlageberatung
</div>

<script>
"use strict";

/* ================= KONFIG ================= */
const API_KEY="d5ohqjhr01qjast6qrjgd5ohqjhr01qjast6qrk0";
const WINDOW=20;
let ANALYSE_MODELL="ausgeglichen";
let LAST_TREND=null;
let chart;

/* ================= AKTIEN ================= */
const STOCKS=[
{t:"AAPL",n:"Apple Inc."},{t:"MSFT",n:"Microsoft Corporation"},
{t:"NVDA",n:"NVIDIA Corporation"},{t:"TSLA",n:"Tesla Inc."},
{t:"AMZN",n:"Amazon.com Inc."},{t:"GOOGL",n:"Alphabet Inc."},
{t:"META",n:"Meta Platforms Inc."},{t:"NFLX",n:"Netflix Inc."},
{t:"INTC",n:"Intel Corporation"},{t:"AMD",n:"Advanced Micro Devices Inc."},
{t:"BABA",n:"Alibaba Group Holding Ltd."},{t:"DIS",n:"The Walt Disney Company"},
{t:"KO",n:"The Coca-Cola Company"},{t:"PEP",n:"PepsiCo Inc."},
{t:"JNJ",n:"Johnson & Johnson"},{t:"PG",n:"Procter & Gamble Co."},
{t:"V",n:"Visa Inc."},{t:"MA",n:"Mastercard Inc."},
{t:"UBER",n:"Uber Technologies Inc."},{t:"SHOP",n:"Shopify Inc."},
{t:"SAP",n:"SAP SE"},{t:"ASML",n:"ASML Holding N.V."},
{t:"NESN.SW",n:"Nestlé S.A."},{t:"ROG.SW",n:"Roche Holding AG"}
];

const select=document.getElementById("stockSelect");
STOCKS.forEach(s=>{
  const o=document.createElement("option");
  o.value=s.t;
  o.textContent=`${s.t} – ${s.n}`;
  select.appendChild(o);
});

/* ================= HILFSFUNKTIONEN ================= */
function setMode(m){ANALYSE_MODELL=m}
function showTab(id){
  document.querySelectorAll(".tabbox").forEach(b=>b.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}
function openBuyPage(){
  window.open(`https://finance.yahoo.com/quote/${select.value}`,"_blank");
}

function EMA(data,p){
  const k=2/(p+1);let e=data[0];
  for(let i=1;i<data.length;i++) e=data[i]*k+e*(1-k);
  return e;
}
function RSI(p){
  let g=0,l=0;
  for(let i=p.length-14;i<p.length-1;i++){
    const d=p[i+1]-p[i];
    d>0?g+=d:l-=d;
  }
  return 100-(100/(1+(g/(l||1))));
}
function volatility(p){
  const m=p.reduce((a,b)=>a+b)/p.length;
  const v=Math.sqrt(p.reduce((s,x)=>s+(x-m)**2,0)/p.length);
  return (v/m)*100;
}
function stability(vol){
  if(vol<2) return ["Stabil","stable"];
  if(vol<5) return ["Mittel","medium"];
  return ["Instabil","risky"];
}
function thresholds(){
  if(ANALYSE_MODELL==="vorsichtig") return {buy:.08,sell:-.04};
  if(ANALYSE_MODELL==="chancen") return {buy:.03,sell:-.08};
  return {buy:.05,sell:-.05};
}

/* ================= DATEN ================= */
async function fetchPrices(symbol,days){
  const now=Math.floor(Date.now()/1000);
  const from=now-days*86400;
  const r=await fetch(
    `https://finnhub.io/api/v1/stock/candle?symbol=${symbol}&resolution=D&from=${from}&to=${now}&token=${API_KEY}`
  );
  const d=await r.json();
  if(d.s!=="ok") throw "Keine Marktdaten";
  return d.c;
}

/* ================= KI ================= */
async function predict(prices){
  const min=Math.min(...prices),max=Math.max(...prices),range=max-min||1;
  const n=prices.map(p=>(p-min)/range);
  const X=[],Y=[];
  for(let i=0;i<n.length-WINDOW;i++){
    X.push(n.slice(i,i+WINDOW).map(v=>[v]));
    Y.push(n[i+WINDOW]);
  }
  const xs=tf.tensor3d(X),ys=tf.tensor2d(Y,[Y.length,1]);
  let model;
  try{
    model=await tf.loadLayersModel("localstorage://model_"+select.value);
  }catch{
    model=tf.sequential();
    model.add(tf.layers.lstm({units:64,inputShape:[WINDOW,1]}));
    model.add(tf.layers.dense({units:1}));
    model.compile({optimizer:"adam",loss:"mse"});
  }
  await model.fit(xs,ys,{epochs:30,verbose:0});
  await model.save("localstorage://model_"+select.value);

  let w=n.slice(-WINDOW),f=[];
  for(let i=0;i<10;i++){
    const p=model.predict(tf.tensor3d([w.map(v=>[v])])).dataSync()[0];
    w.shift();w.push(p);
    f.push(p*range+min);
  }
  return f;
}

/* ================= ANALYSE ================= */
async function analyze(){
  try{
    status.textContent="Analyse läuft…";
    const days=+timeSelect.value;
    const prices=await fetchPrices(select.value,days);
    const forecast=await predict(prices);

    const last=prices.at(-1);
    const pred=forecast.at(-1);
    const ema9=EMA(prices,9);
    const ema21=EMA(prices,21);
    const trend=ema9>ema21?"Aufwärts":"Abwärts";
    if(LAST_TREND && LAST_TREND!==trend) alert("⚠️ Trendwechsel erkannt");
    LAST_TREND=trend;

    const rsi=RSI(prices);
    const vol=volatility(prices);
    const [stabText,stabClass]=stability(vol);
    const diff=(pred-last)/last;
    const t=thresholds();

    let signal="HALTEN",cls="hold";
    if(diff>t.buy && trend==="Aufwärts" && rsi<70){signal="KAUFEN";cls="buy";}
    if(diff<t.sell && trend==="Abwärts" && rsi>30){signal="VERKAUFEN";cls="sell";}

    const confidence=Math.min(100,Math.abs(diff)*100*2+(trend==="Aufwärts"?10:0)+(5-vol));

    result.innerHTML=`
      <tr>
        <td>${last.toFixed(2)}</td>
        <td>${pred.toFixed(2)}</td>
        <td class="${cls}">${signal}</td>
        <td>${confidence.toFixed(0)}%</td>
      </tr>`;

    explanation.innerHTML=
      `Trend: ${trend}<br>RSI: ${rsi.toFixed(1)}<br>Analyse-Modus: ${ANALYSE_MODELL}`;

    fundamental.innerHTML=
      `<b>Firmen-Stabilität:</b>
       <span class="${stabClass}">${stabText}</span><br>
       <b>Volatilität:</b> ${vol.toFixed(2)} %`;

    if(chart) chart.destroy();
    chart=new Chart(chartEl,{
      type:"line",
      data:{
        labels:[...prices.map((_,i)=>"T"+i),...forecast.map((_,i)=>"F"+i)],
        datasets:[
          {label:"Kurs",data:[...prices,...Array(forecast.length).fill(null)],borderColor:"#00ccaa"},
          {label:"KI-Prognose",data:[...Array(prices.length).fill(null),...forecast],borderColor:"#ffaa55"}
        ]
      }
    });

    status.textContent="Analyse abgeschlossen";
  }catch(e){
    status.textContent="Fehler: "+e;
  }
}

const status=document.getElementById("status");
const chartEl=document.getElementById("chart");
</script>
</body>
</html>
