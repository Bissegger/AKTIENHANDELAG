<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Aktien KI Analyse</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{background:#121212;color:#e0f7f4;font-family:Arial;margin:0;padding:14px}
h1{text-align:center;font-size:1.4rem}
.subtitle{text-align:center;font-size:.85rem;color:#9fd3cc}

.controls{display:flex;flex-direction:column;gap:8px;margin:12px 0}
select,button{
  padding:10px;font-size:1rem;border-radius:8px;
  background:#1b1b1b;color:#e0f7f4;
  border:1px solid #00ccaa
}
button:active{transform:scale(.98)}
button:disabled{opacity:.5}

.status{text-align:center;font-weight:bold;margin:6px 0;font-size:.9rem}

.progress-box{
  width:100%;background:#1a1a1a;border-radius:8px;
  overflow:hidden;margin:8px 0;display:none
}
.progress-bar{
  height:10px;width:0%;background:#00ccaa;
  transition:width .2s
}

canvas{
  width:100%!important;height:260px!important;
  background:#1a1a1a;border-radius:10px;padding:6px
}

table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #00ccaa;padding:6px;text-align:center;font-size:.85rem}

.buy{color:#00ff88;font-weight:bold}
.sell{color:#ff6666;font-weight:bold}
.hold{color:#ffaa55;font-weight:bold}
</style>
</head>

<body>

<h1>AKTIEN KI ANALYSE</h1>
<div class="subtitle">Sofort-Analyse Â· Kein Freeze</div>

<div class="controls">
  <select id="stock"></select>
  <button id="kiBtn">ðŸ§  KI: EIN</button>
  <button id="analyzeBtn">ðŸ“Š Analyse starten</button>
</div>

<div class="progress-box" id="progressBox">
  <div class="progress-bar" id="progressBar"></div>
</div>

<div class="status" id="marketStatus"></div>
<div class="status" id="status">System bereit</div>

<canvas id="chart"></canvas>

<table>
<thead>
<tr>
  <th>Kurs</th>
  <th>Prognose</th>
  <th>Signal</th>
</tr>
</thead>
<tbody id="result"></tbody>
</table>

<script>
"use strict";

/* ========= DOM ========= */
const stockSel = document.getElementById("stock");
const kiBtn = document.getElementById("kiBtn");
const analyzeBtn = document.getElementById("analyzeBtn");
const statusEl = document.getElementById("status");
const marketEl = document.getElementById("marketStatus");
const resultEl = document.getElementById("result");
const progressBox = document.getElementById("progressBox");
const progressBar = document.getElementById("progressBar");
const chartCanvas = document.getElementById("chart");

/* ========= STATE ========= */
let KI = true;
let isAnalyzing = false;
let chart = null;

/* ========= AKTIEN ========= */
[
["AAPL","Apple"],["MSFT","Microsoft"],["NVDA","NVIDIA"],
["AMZN","Amazon"],["TSLA","Tesla"],
["NESN.SW","NestlÃ©"],["ROG.SW","Roche"]
].forEach(s=>{
  const o=document.createElement("option");
  o.value=s[0]; o.textContent=`${s[0]} â€“ ${s[1]}`;
  stockSel.appendChild(o);
});

/* ========= BUTTONS ========= */
kiBtn.onclick=()=>{
  KI=!KI;
  kiBtn.textContent="ðŸ§  KI: "+(KI?"EIN":"AUS");
};

analyzeBtn.onclick=()=>{
  if(!isAnalyzing) analyze();
};

/* ========= UI ========= */
function setProgress(p){
  progressBox.style.display="block";
  progressBar.style.width=p+"%";
}
function resetProgress(){
  progressBar.style.width="0%";
  progressBox.style.display="none";
}

/* ========= MARKT ========= */
function updateMarket(){
  const d=new Date().getDay();
  marketEl.textContent =
    (d===0||d===6)
    ?"ðŸ”´ BÃ¶rse geschlossen â€“ letzte Kurse"
    :"ðŸŸ¢ BÃ¶rse geÃ¶ffnet";
}

/* ========= DATEN ========= */
async function fetchPrices(symbol){
  const key="CACHE_"+symbol;
  try{
    const r=await fetch(
      `https://finnhub.io/api/v1/quote?symbol=${symbol}&token=d5ohqjhr01qjast6qrjgd5ohqjhr01qjast6qrk0`
    );
    const d=await r.json();
    if(d.c){
      localStorage.setItem(key,d.c);
      return d.c;
    }
  }catch{}
  return Number(localStorage.getItem(key))||null;
}

/* ========= ANALYSE ========= */
async function analyze(){
  isAnalyzing=true;
  analyzeBtn.disabled=true;

  try{
    statusEl.textContent="Analyse startetâ€¦";
    setProgress(10);
    updateMarket();

    const price=await fetchPrices(stockSel.value);
    if(!price){
      statusEl.textContent="âŒ Keine Marktdaten";
      return;
    }

    setProgress(50);

    const factor = KI ? 0.01 : 0;
    const forecast = price*(1+factor);

    if(chart) chart.destroy();
    chart = new Chart(chartCanvas,{
      type:"line",
      data:{
        labels:["Jetzt","Prognose"],
        datasets:[{
          label:"Preis",
          data:[price,forecast],
          borderColor:"#00ccaa"
        }]
      }
    });

    const diff=(forecast-price)/price;
    const signal=diff>0.02?"KAUFEN":diff<-0.02?"VERKAUFEN":"HALTEN";
    const cls=signal==="KAUFEN"?"buy":signal==="VERKAUFEN"?"sell":"hold";

    resultEl.innerHTML=`
      <tr>
        <td>${price.toFixed(2)}</td>
        <td>${forecast.toFixed(2)}</td>
        <td class="${cls}">${signal}</td>
      </tr>`;

    setProgress(100);
    statusEl.textContent="âœ… Analyse abgeschlossen";

  }finally{
    setTimeout(resetProgress,600);
    analyzeBtn.disabled=false;
    isAnalyzing=false;
  }
}

updateMarket();
</script>

</body>
</html>
