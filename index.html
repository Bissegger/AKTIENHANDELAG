<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>YANNIC KÖBI AKTIEN HANDEL AG – KI Analyse</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.2.0/dist/tf.min.js"></script>

<style>
body{background:#121212;color:#d8f3ef;font-family:Arial;margin:0;padding:16px}
h1{text-align:center;margin:6px 0}
.subtitle{text-align:center;font-size:.85rem;color:#a8d8d0}
.controls{display:flex;justify-content:center;gap:10px;flex-wrap:wrap;margin:10px 0}
select,button{background:#1b1b1b;color:#d8f3ef;border:1px solid #00ccaa;padding:6px 12px;border-radius:6px;cursor:pointer}
button:hover{background:#00ccaa;color:#000}
.status{text-align:center;font-weight:bold;margin:6px}
canvas{max-width:1200px;margin:20px auto;display:block;background:#1a1a1a;border-radius:8px;padding:10px}
table{width:100%;max-width:1200px;margin:auto;border-collapse:collapse}
th,td{border:1px solid #00ccaa;padding:6px;text-align:center}
.buy{color:#00ff88;font-weight:bold}
.sell{color:#ff6666;font-weight:bold}
.hold{color:#ffaa55;font-weight:bold}
.tabs{display:flex;justify-content:center;gap:10px;margin-top:12px}
.tabbox{max-width:1200px;margin:10px auto;background:#1a1a1a;border:1px solid #00ccaa;padding:10px;border-radius:6px}
.hidden{display:none}
.footer{text-align:center;font-size:.8rem;color:#9fcfc8;margin-top:12px}
.ok{color:#00ff88}
.warn{color:#ffaa55}
.bad{color:#ff6666}
</style>
</head>

<body>

<h1>YANNIC KÖBI AKTIEN HANDEL AG</h1>
<div class="subtitle">KI-gestützte Aktienanalyse (echte Marktdaten)</div>

<div class="controls">
<select id="stockSelect"></select>
<select id="timeSelect">
<option value="30">1 Monat</option>
<option value="60">2 Monate</option>
<option value="90" selected>3 Monate</option>
</select>
</div>

<div class="controls">
<button onclick="setMode('vorsichtig')">Vorsichtig</button>
<button onclick="setMode('ausgeglichen')">Ausgeglichen</button>
<button onclick="setMode('chancen')">Chancenorientiert</button>
</div>

<div class="controls">
<button onclick="analyze()">Analyse durchführen</button>
<button onclick="exportCSV()">CSV Export</button>
<button onclick="toggleFav()">⭐ Favorit</button>
</div>

<div class="status" id="status">System bereit</div>
<div class="status" id="datatime"></div>

<canvas id="chart"></canvas>

<table>
<thead>
<tr>
<th>Aktueller Kurs</th>
<th>KI-Prognose</th>
<th>Signal</th>
<th>Abweichung</th>
</tr>
</thead>
<tbody id="result"></tbody>
</table>

<div class="tabs">
<button onclick="showTab('analysis')">Analyse</button>
<button onclick="showTab('fundamental')">Firmen-Stabilität</button>
</div>

<div id="analysis" class="tabbox">
<div id="explanation">–</div>
</div>

<div id="fundamental" class="tabbox hidden">
<div id="stability">–</div>
</div>

<div class="footer">Keine Anlageberatung – Analyse & KI-Simulation</div>

<script>
"use strict";

/* ================== API ================== */
const API_KEY = atob("ZDVvaHFqaHIwMWFqc3Q2cXJqZ2Q1b2hxamhyMDFxamFzdDZxcmsw");

/* ================== AKTIENLISTE (DEINE) ================== */
const STOCKS = [
{t:"AAPL",n:"Apple Inc."},{t:"MSFT",n:"Microsoft Corporation"},
{t:"NVDA",n:"NVIDIA Corporation"},{t:"TSLA",n:"Tesla Inc."},
{t:"AMZN",n:"Amazon.com Inc."},{t:"GOOGL",n:"Alphabet Inc."},
{t:"META",n:"Meta Platforms Inc."},{t:"NFLX",n:"Netflix Inc."},
{t:"INTC",n:"Intel Corporation"},{t:"AMD",n:"Advanced Micro Devices Inc."},
{t:"BABA",n:"Alibaba Group Holding Ltd."},{t:"DIS",n:"The Walt Disney Company"},
{t:"KO",n:"The Coca-Cola Company"},{t:"PEP",n:"PepsiCo Inc."},
{t:"JNJ",n:"Johnson & Johnson"},{t:"PG",n:"Procter & Gamble Co."},
{t:"V",n:"Visa Inc."},{t:"MA",n:"Mastercard Inc."},
{t:"SAP",n:"SAP SE"},{t:"ASML",n:"ASML Holding N.V."},
{t:"NESN.SW",n:"Nestlé S.A."},{t:"ROG.SW",n:"Roche Holding AG"}
];

const stockSelect=document.getElementById("stockSelect");
STOCKS.forEach(s=>{
  const o=document.createElement("option");
  o.value=s.t;
  o.textContent=`${s.t} – ${s.n}`;
  stockSelect.appendChild(o);
});

/* ================== UI ================== */
let MODE="ausgeglichen";
function setMode(m){MODE=m}
function showTab(id){
  document.querySelectorAll(".tabbox").forEach(b=>b.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

/* ================== MARKTDATEN + FALLBACK ================== */
async function fetchPrices(sym,days){
  const now=Math.floor(Date.now()/1000);
  const from=now-days*86400;
  try{
    const r=await fetch(`https://finnhub.io/api/v1/stock/candle?symbol=${sym}&resolution=D&from=${from}&to=${now}&token=${API_KEY}`);
    const d=await r.json();
    if(d.s==="ok" && d.c.length>20){
      localStorage.setItem("LAST_"+sym,JSON.stringify(d.c));
      localStorage.setItem("TIME_"+sym,new Date().toLocaleString());
      datatime.textContent="Datenstand: "+new Date().toLocaleString();
      return d.c;
    }
  }catch{}
  const cache=localStorage.getItem("LAST_"+sym);
  if(cache){
    datatime.textContent="Fallback (letzte echte Daten): "+localStorage.getItem("TIME_"+sym);
    return JSON.parse(cache);
  }
  throw "Keine Marktdaten verfügbar";
}

/* ================== KI (LSTM) ================== */
const WINDOW=20;
async function predict(prices){
  const min=Math.min(...prices),max=Math.max(...prices),r=max-min||1;
  const n=prices.map(p=>(p-min)/r);
  const X=[],Y=[];
  for(let i=0;i<n.length-WINDOW;i++){
    X.push(n.slice(i,i+WINDOW).map(v=>[v]));
    Y.push(n[i+WINDOW]);
  }
  const xs=tf.tensor3d(X),ys=tf.tensor2d(Y,[Y.length,1]);
  const m=tf.sequential();
  m.add(tf.layers.lstm({units:32,inputShape:[WINDOW,1]}));
  m.add(tf.layers.dense({units:1}));
  m.compile({optimizer:"adam",loss:"mse"});
  await m.fit(xs,ys,{epochs:25,verbose:0});
  let w=n.slice(-WINDOW),f=[];
  for(let i=0;i<7;i++){
    let p=m.predict(tf.tensor3d([w.map(v=>[v])])).dataSync()[0];
    w.shift(); w.push(p);
    f.push(p*r+min);
  }
  return f;
}

/* ================== STABILITÄTS-ANALYSE ================== */
function companyStability(prices){
  const vol = Math.sqrt(prices.reduce((s,p,i,a)=>i? s+(p-a[i-1])**2 : s,0)/prices.length);
  if(vol<2) return "Sehr stabil (defensives Unternehmen)";
  if(vol<5) return "Stabil (moderate Schwankungen)";
  return "Volatil (höheres Risiko)";
}

/* ================== ANALYSE ================== */
async function analyze(){
  try{
    status.textContent="Analyse läuft…";
    const prices=await fetchPrices(stockSelect.value,+timeSelect.value);
    const forecast=await predict(prices);

    const last=prices.at(-1);
    const pred=forecast.at(-1);
    const diff=(pred-last)/last;

    let signal="HALTEN",cls="hold";
    if(diff>0.05) signal="KAUFEN",cls="buy";
    if(diff<-0.05) signal="VERKAUFEN",cls="sell";

    result.innerHTML=`
      <tr>
        <td>${last.toFixed(2)}</td>
        <td>${pred.toFixed(2)}</td>
        <td class="${cls}">${signal}</td>
        <td>${(Math.abs(diff)*100).toFixed(1)}%</td>
      </tr>`;

    explanation.innerHTML=
      `Modus: ${MODE}<br>
       Prognosehorizont: 7 Tage`;

    stability.textContent = companyStability(prices);

    if(window.chart) chart.destroy();
    chart=new Chart(document.getElementById("chart"),{
      type:"line",
      data:{
        labels:prices.map((_,i)=>i),
        datasets:[
          {label:"Kurs",data:prices,borderColor:"#00ccaa"},
          {label:"KI-Prognose",data:[...Array(prices.length-forecast.length).fill(null),...forecast],borderColor:"#ffaa55"}
        ]
      }
    });

    status.textContent="Analyse abgeschlossen ✓";
  }catch(e){
    status.textContent="Fehler: "+e;
  }
}

/* ================== EXTRA ================== */
function exportCSV(){
  const r=document.querySelector("#result tr");
  if(!r) return;
  const d=[...r.children].map(td=>td.innerText);
  const csv="Aktie,Preis,Prognose,Signal,Abweichung\n"+stockSelect.value+","+d.join(",");
  const b=new Blob([csv],{type:"text/csv"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(b);
  a.download="aktienanalyse.csv";
  a.click();
}

function toggleFav(){
  let f=JSON.parse(localStorage.getItem("FAVS")||"[]");
  f.includes(stockSelect.value)?f=f.filter(x=>x!==stockSelect.value):f.push(stockSelect.value);
  localStorage.setItem("FAVS",JSON.stringify(f));
  alert("Favoriten aktualisiert");
}
</script>
</body>
</html>
